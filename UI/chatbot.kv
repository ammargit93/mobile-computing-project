#:import MDTextField kivymd.uix.textfield.MDTextField
#:import MDFloatingActionButton kivymd.uix.button.MDFloatingActionButton
#:import MDFillRoundFlatButton kivymd.uix.button.MDFillRoundFlatButton

<ChatMessage>:
    orientation: "horizontal"
    size_hint_y: None
    height: max(root.minimum_height, content.height)
    padding: [15, 10]
    spacing: 15

    MDIcon:
        icon: root.icon if hasattr(root, 'icon') else "account"
        size_hint: None, None
        size: "32dp", "32dp"
        pos_hint: {"center_y": 0.5}
        theme_text_color: "Custom"
        text_color: app.theme_cls.primary_color

    BoxLayout:
        id: content
        orientation: "vertical"
        size_hint_x: 0.85
        spacing: 2
        padding: [0, 5]

        MDLabel:
            text: root.sender
            font_style: "Subtitle1"
            bold: True
            size_hint_y: None
            height: self.texture_size[1]

        MDLabel:
            text: root.message
            font_style: "Body1"
            size_hint_y: None
            height: self.texture_size[1]
            halign: "left"
            padding: [0, 0, 0, 5]

<ChatScreen>:
    orientation: "vertical"
    spacing: 0
    padding: 0

    ScrollView:
        id: chat_scroll
        do_scroll_x: False
        bar_width: "6dp"

        BoxLayout:
            id: chat_list
            orientation: "vertical"
            size_hint_y: None
            height: self.minimum_height
            spacing: "10dp"
            padding: ["15dp", "15dp", "15dp", "15dp"]

    BoxLayout:
        id: input_box
        size_hint_y: None
        height: "60dp"
        padding: [5, 5, 5, 5]
        spacing: 5

        MDFloatingActionButton:
            id: attach_btn
            icon: "attachment"
            size_hint: None, None
            size: "30dp", "30dp"
            elevation: 0
            pos_hint: {"center_y": 0.5}
            on_release: root.show_file_chooser()

        MDTextField:
            id: message_input
            hint_text: "Type your message..."
            mode: "rectangle"
            multiline: True
            size_hint_x: 0.8
            write_tab: False
            padding: [10, 5]
            pos_hint: {"center_y": 0.5}

        MDFillRoundFlatButton:
            id: send_btn
            text: "Send"
            size_hint_x: 0.15
            size_hint_y: None
            height: "40dp"
            on_release: root.send_message()
            pos_hint: {"center_y": 0.5}