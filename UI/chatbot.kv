#:kivy 2.0.0
#:import dp kivy.metrics.dp
#:import MDCard kivymd.uix.card.MDCard
#:import MDIcon kivymd.uix.label.MDIcon

<ChatMessage>:
    size_hint_y: None
    height: max(dp(80), text_box.height + dp(20))
    
    BoxLayout:
        orientation: 'horizontal'
        padding: dp(10)
        spacing: dp(10)
        
        MDIcon:
            icon: "robot" if root.is_bot else "account"
            size_hint: (None, None)
            size: (dp(40), dp(40))
            theme_text_color: "Custom"
            text_color: (0, 1, 1, 1) if root.is_bot else (1, 1, 0, 1)
        
        MDCard:
            size_hint: (None, None)
            size: (dp(250), text_box.height + dp(20))
            elevation: 1
            radius: [15,]
            md_bg_color: (0.1, 0.1, 0.3, 1) if root.is_bot else (0.2, 0.2, 0.4, 1)
            
            MDLabel:
                id: text_box
                text: root.message
                size_hint_y: None
                height: self.texture_size[1]
                padding: dp(10)
                halign: "left"
                valign: "top"
                markup: True
                theme_text_color: "Custom"
                text_color: (1, 1, 1, 1)

<FileBubble>:
    size_hint_y: None
    height: dp(80)
    
    BoxLayout:
        orientation: 'horizontal'
        padding: dp(10)
        spacing: dp(10)
        
        MDIcon:
            icon: root.file_icon
            size_hint: (None, None)
            size: (dp(40), dp(40))
            theme_text_color: "Custom"
            text_color: (0, 1, 1, 1)
        
        MDCard:
            size_hint: (None, None)
            size: (dp(250), dp(60))
            elevation: 1
            radius: [15,]
            md_bg_color: (0.1, 0.1, 0.3, 1)
            
            BoxLayout:
                orientation: 'vertical'
                padding: dp(10)
                spacing: dp(5)
                
                MDLabel:
                    text: root.file_name
                    size_hint_y: None
                    height: self.texture_size[1]
                    halign: "left"
                    theme_text_color: "Custom"
                    text_color: (1, 1, 1, 1)
                    font_style: "Subtitle1"
                
                MDLabel:
                    text: root.file_size
                    size_hint_y: None
                    height: self.texture_size[1]
                    halign: "left"
                    theme_text_color: "Custom"
                    text_color: (0.8, 0.8, 0.8, 1)
                    font_style: "Caption"

<ChatbotScreen>:
    selected_file: ""
    name: "chatbot_screen"
    
    MDBoxLayout:
        orientation: "vertical"
        md_bg_color: 0.05, 0.05, 0.1, 1 

        MDTopAppBar:
            id: top_app_bar
            title: "üöÄ GenQuery Chatbot"
            elevation: 6
            left_action_items: [["menu", lambda x: root.toggle_nav_drawer()]]
            right_action_items: [["logout", lambda x: root.logout()]]
            md_bg_color: 0.1, 0.1, 0.3, 1
            specific_text_color: 0, 1, 1, 1  

        ScrollView:
            id: chat_scroll
            bar_width: dp(10)
            scroll_type: ['bars', 'content']
            effect_cls: "ScrollEffect"
            
            MDBoxLayout:
                id: chat_container
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                padding: dp(10)
                spacing: dp(10)
                adaptive_height: True

        MDBoxLayout:
            size_hint_y: None
            height: dp(65)
            padding: dp(10)
            spacing: dp(5)

            BoxLayout:
                orientation: "horizontal"
                size_hint_x: 0.8
                spacing: dp(5)

                MDTextField:
                    id: message_input
                    hint_text: "Type a command..."
                    mode: "fill"
                    size_hint_x: 0.8
                    height: dp(10)
                    text_color_focus: 0, 1, 1, 1
                    line_color_focus: 0.5, 0.5, 1, 1
                    md_bg_color: 0.1, 0.1, 0.3, 0.8
                    radius: [15, 15, 15, 15]

                MDFillRoundFlatButton:
                    text: "üìÅ"
                    size_hint_x: 0.2
                    md_bg_color: 0.2, 0.2, 0.4, 1
                    text_color: 1, 1, 1, 1
                    on_release: root.open_file_chooser()

            MDFillRoundFlatButton:
                text: "üöÄ Send"
                size_hint_x: 0.2
                md_bg_color: 0, 1, 1, 1  
                text_color: 0, 0, 0, 1
                on_release: root.send_message()

    MDNavigationLayout:
        ScreenManager:
            Screen:
                BoxLayout:
                    orientation: "vertical"

        MDNavigationDrawer:
            id: nav_drawer
            BoxLayout:
                orientation: "vertical"
                spacing: "8dp"
                padding: "8dp"

                MDLabel:
                    text: "Menu"
                    theme_text_color: "Secondary"
                    font_style: "H6"
                    size_hint_y: None
                    height: self.texture_size[1]

                MDList:
                    OneLineListItem:
                        text: "History"
                        pos_hint: {"center_x": 0.5}
                        on_release: root.menu_callback("History")

                    OneLineListItem:
                        text: "Help"
                        pos_hint: {"center_x": 0.5}
                        on_release: root.menu_callback("Help")